document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("form").forEach(function(e){e.addEventListener("submit",function(){e.querySelectorAll(".ignore_form").forEach(function(t){t.disabled=!0})})});const h=document.querySelectorAll("[data-tab]"),y=document.querySelectorAll("[data-for-tab]");function v(e){h.forEach(t=>{t.classList.toggle("active",t.dataset.tab===e)}),y.forEach(t=>{t.classList.toggle("active",t.dataset.forTab===e)})}if(h){h.forEach(t=>{t.addEventListener("click",()=>{v(t.dataset.tab)})});const e=document.querySelector("[data-tab].active");e&&v(e.dataset.tab)}Alpine.store("page").searchSelect=function(e){const t=e.parentElement,s=t.querySelector("[data-url]"),i=t.querySelector('input[type="hidden"]'),a=t.querySelector(".custom-list"),o=s.dataset.url;let d;const m=n=>{a.innerHTML="",Array.isArray(n)&&n.length>0?n.forEach(c=>{const r=document.createElement("li");if(r.textContent=c.text,s.getAttribute("custom")==="true"){let f=function(){s.value=c.text,i.value=c.id,a.classList.add("hide")};var l=f;r.removeEventListener("click",f),r.addEventListener("click",f)}else r.setAttribute("x-on:click",`setItem($event.target, keyData, ${c.id}, "${c.text.replace('"',"'").replace('"',"'")}")`);a.appendChild(r)}):a.innerHTML='<li style="color:#999;cursor:default;">Нічого не знайдено</li>'};(()=>{clearTimeout(d),d=setTimeout(()=>{const n=s.value.trim().toLowerCase();if(o)axios.get(o,{params:{q:n}}).then(c=>{m(c.data.items||[]),a.classList.remove("hide")}).catch(c=>{console.error("AJAX error:",c)});else{let c=!1;a.querySelectorAll("li").forEach(r=>{const l=r.textContent.toLowerCase().includes(n);if(s.getAttribute("custom")==="true"){let p=function(){s.value=r.textContent,i.value=r.id,a.classList.add("hide")};var f=p;r.removeEventListener("click",p),r.addEventListener("click",p)}else r.setAttribute("x-on:click",`setItem($event.target, keyData, ${item.id}, "${item.text.replace('"',"'").replace('"',"'")}")`);r.style.display=l?"block":"none",l&&(c=!0)}),c?a.classList.remove("hide"):a.classList.add("hide")}},300)})(),document.addEventListener("click",n=>{t.contains(n.target)||a.classList.add("hide")})},Alpine.store("page").multiSelect=function(){document.querySelectorAll(".tag-select").forEach(e=>{const t=new Choices(e,{removeItemButton:!0,placeholderValue:"Виберіть або введіть...",searchPlaceholderValue:"Пошук...",duplicateItemsAllowed:!1,shouldSort:!1,searchEnabled:!e.dataset.noSearch});let s;const i=e.dataset.url;if(!i)return;const a=e.parentElement.querySelector('input[type="search"]');function o(d){const m=d.target.value;clearTimeout(s),s=setTimeout(()=>{axios.get(i,{params:{q:m}}).then(u=>{const n=u.data.items||[],c=Array.from(e.options).filter(l=>l.selected).map(l=>l.value),r=n.filter(l=>!c.includes(l.id.toString()));r.length&&t.setChoices(r.map(l=>({value:l.id,label:l.text,selected:!1,disabled:!1})),"value","label",!1)}).catch(u=>{console.error("AJAX error:",u)})},300)}a.addEventListener("input",o),a.addEventListener("click",o)})},Alpine.store("page").multiSelect(),document.querySelectorAll(".image-upload").forEach(e=>{const t=e.querySelector('input[type="file"]'),s=e.querySelector("img");t.addEventListener("change",i=>{const a=i.target.files[0];if(a&&a.type.startsWith("image/")){const o=new FileReader;o.onload=function(d){s.src=d.target.result,s.style.display="block"},o.readAsDataURL(a)}else s.src="",s.style.display="none",alert("Будь ласка, виберіть зображення (JPEG, PNG, WEBP...)")})})});
