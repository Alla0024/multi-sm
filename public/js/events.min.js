document.addEventListener("DOMContentLoaded",()=>{const g=document.querySelectorAll("[data-tab]"),A=document.querySelectorAll("[data-for-tab]");function E(t){g.forEach(e=>{e.classList.toggle("active",e.dataset.tab===t)}),A.forEach(e=>{e.classList.toggle("active",e.dataset.forTab===t)})}if(g){g.forEach(e=>{e.addEventListener("click",()=>{E(e.dataset.tab)})});const t=document.querySelector("[data-tab].active");t&&E(t.dataset.tab)}Alpine.store("page").searchSelect=function(t){const e=t.parentElement,a=e.querySelector("[data-url]"),i=e.querySelector('input[type="hidden"]'),l=e.querySelector(".custom-list"),s=a.dataset.url;let d;const y=(r,o="")=>{l.innerHTML="",Array.isArray(r)&&r.length>0?(r.forEach(c=>{if(c.text.toLowerCase().includes(o)){const m=document.createElement("li");if(m.textContent=c.text,a.getAttribute("custom")==="true"){let u=function(){a.value=c.text,i.value=c.id,l.classList.add("hide")};var n=u;m.removeEventListener("click",u),m.addEventListener("click",u)}else m.setAttribute("x-on:click",`setItem($event.target, keyData, ${c.id}, "${c.text.replace('"',"'").replace('"',"'")}")`);l.appendChild(m)}}),l.innerHTML==""&&(l.innerHTML='<li style="color:#999;cursor:default;">Нічого не знайдено</li>')):l.innerHTML='<li style="color:#999;cursor:default;">Нічого не знайдено</li>'};(()=>{clearTimeout(d),d=setTimeout(()=>{const r=a.value.trim().toLowerCase();if(s)axios.get(s,{params:{q:r}}).then(o=>{y(o.data.items||[],r),l.classList.remove("hide")}).catch(o=>{console.error("AJAX error:",o)});else{let o=!1;l.querySelectorAll("li").forEach(c=>{const n=c.textContent.toLowerCase().includes(r);if(a.getAttribute("custom")==="true"){let u=function(){a.value=c.textContent,i.value=c.id,l.classList.add("hide")};var m=u;c.removeEventListener("click",u),c.addEventListener("click",u)}else c.setAttribute("x-on:click",`setItem($event.target, keyData, ${item.id}, "${item.text.replace('"',"'").replace('"',"'")}")`);c.style.display=n?"block":"none",n&&(o=!0)}),o?l.classList.remove("hide"):l.classList.add("hide")}r==""&&(i.value="")},300)})(),document.addEventListener("click",r=>{e.contains(r.target)||l.classList.add("hide")})};let h=[];Alpine.store("page").multiSelect=function(){h=[],document.querySelectorAll(".tag-select").forEach(t=>{const e=new Choices(t,{removeItemButton:!0,placeholderValue:"Виберіть або введіть...",searchPlaceholderValue:"Пошук...",duplicateItemsAllowed:!1,shouldSort:!1,searchEnabled:!t.dataset.noSearch});let a;const i=t.dataset.url;if(!i){h.push(e);return}const l=t.parentElement.querySelector('input[type="search"]');function s(d){const y=d.target.value;clearTimeout(a),a=setTimeout(()=>{axios.get(i,{params:{q:y}}).then(p=>{const r=p.data.items||[],o=Array.from(t.options).filter(n=>n.selected).map(n=>n.value),c=r.filter(n=>!o.includes(n.id.toString()));c.length&&e.setChoices(c.map(n=>({value:n.id,label:n.text,selected:!1,disabled:!1})),"value","label",!1)}).catch(p=>{console.error("AJAX error:",p)})},300)}l.addEventListener("input",s),l.addEventListener("click",s),h.push(e)})},Alpine.store("page").multiSelectDestroy=function(){console.log(h),h.forEach(t=>t.destroy())},Alpine.store("page").multiSelect();let L=document.querySelectorAll(".image-uploaddd");L&&L.forEach(t=>{const e=t.querySelector('input[type="file"]'),a=t.querySelector("img");e.addEventListener("change",i=>{const l=i.target.files[0];if(l&&l.type.startsWith("image/")){const s=new FileReader;s.onload=function(d){a.src=d.target.result,a.style.display="block"},s.readAsDataURL(l)}else a.src="",a.style.display="none",alert("Будь ласка, виберіть зображення (JPEG, PNG, WEBP...)")})});const S=document.querySelectorAll(".clear-img");S&&S.forEach(t=>{t.addEventListener("click",()=>{t.parentElement.parentElement.querySelector("input").value="",t.parentElement.parentElement.querySelector("img").src="/images/common/no_images.png"})}),Alpine.store("page").mask=t=>{let e=(t.value||"").replace(/\D+/g,"");if(e.startsWith("380")?e=e.slice(3):e.startsWith("0")&&(e=e.slice(1)),e=e.slice(0,9),!e.length){t.value="";return}let a="+380 ";e.length<=2?a+=e:e.length<=5?a+=e.slice(0,2)+" "+e.slice(2):e.length<=7?a+=e.slice(0,2)+" "+e.slice(2,5)+"-"+e.slice(5):a+=e.slice(0,2)+" "+e.slice(2,5)+"-"+e.slice(5,7)+"-"+e.slice(7,9),t.value=a};const v=document.querySelector(".checkbox-father");v&&v.addEventListener("change",()=>{document.querySelectorAll(".checkbox-child").forEach(t=>{t.checked=v.checked})});const f=document.getElementById("search_form");f&&f.addEventListener("submit",function(t){const e=document.querySelector("#multiple_search");if(e){const a=e.name.replace("[]",""),i=Array.from(e.selectedOptions).map(d=>d.value),l=f.querySelector(`input[name="${a}"]`);l&&l.remove();const s=document.createElement("input");s.type="hidden",s.name=a,s.value=i.join(","),f.appendChild(s),e.disabled=!0}})});
