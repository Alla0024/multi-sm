document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("form").forEach(function(t){t.addEventListener("submit",function(){t.querySelectorAll(".ignore_form").forEach(function(e){e.disabled=!0})})});const f=document.querySelectorAll("[data-tab]"),E=document.querySelectorAll("[data-for-tab]");function v(t){f.forEach(e=>{e.classList.toggle("active",e.dataset.tab===t)}),E.forEach(e=>{e.classList.toggle("active",e.dataset.forTab===t)})}if(f){f.forEach(e=>{e.addEventListener("click",()=>{v(e.dataset.tab)})});const t=document.querySelector("[data-tab].active");t&&v(t.dataset.tab)}Alpine.store("page").searchSelect=function(t){const e=t.parentElement,l=e.querySelector("[data-url]"),i=e.querySelector('input[type="hidden"]'),s=e.querySelector(".custom-list"),o=l.dataset.url;let u;const h=n=>{s.innerHTML="",Array.isArray(n)&&n.length>0?n.forEach(c=>{const a=document.createElement("li");if(a.textContent=c.text,l.getAttribute("custom")==="true"){let m=function(){l.value=c.text,i.value=c.id,s.classList.add("hide")};var r=m;a.removeEventListener("click",m),a.addEventListener("click",m)}else a.setAttribute("x-on:click",`setItem($event.target, keyData, ${c.id}, "${c.text.replace('"',"'").replace('"',"'")}")`);s.appendChild(a)}):s.innerHTML='<li style="color:#999;cursor:default;">Нічого не знайдено</li>'};(()=>{clearTimeout(u),u=setTimeout(()=>{const n=l.value.trim().toLowerCase();if(o)axios.get(o,{params:{q:n}}).then(c=>{h(c.data.items||[]),s.classList.remove("hide")}).catch(c=>{console.error("AJAX error:",c)});else{let c=!1;s.querySelectorAll("li").forEach(a=>{const r=a.textContent.toLowerCase().includes(n);if(l.getAttribute("custom")==="true"){let p=function(){l.value=a.textContent,i.value=a.id,s.classList.add("hide")};var m=p;a.removeEventListener("click",p),a.addEventListener("click",p)}else a.setAttribute("x-on:click",`setItem($event.target, keyData, ${item.id}, "${item.text.replace('"',"'").replace('"',"'")}")`);a.style.display=r?"block":"none",r&&(c=!0)}),c?s.classList.remove("hide"):s.classList.add("hide")}},300)})(),document.addEventListener("click",n=>{e.contains(n.target)||s.classList.add("hide")})},Alpine.store("page").multiSelect=function(){document.querySelectorAll(".tag-select").forEach(t=>{const e=new Choices(t,{removeItemButton:!0,placeholderValue:"Виберіть або введіть...",searchPlaceholderValue:"Пошук...",duplicateItemsAllowed:!1,shouldSort:!1,searchEnabled:!t.dataset.noSearch});let l;const i=t.dataset.url;if(!i)return;const s=t.parentElement.querySelector('input[type="search"]');function o(u){const h=u.target.value;clearTimeout(l),l=setTimeout(()=>{axios.get(i,{params:{q:h}}).then(d=>{const n=d.data.items||[],c=Array.from(t.options).filter(r=>r.selected).map(r=>r.value),a=n.filter(r=>!c.includes(r.id.toString()));a.length&&e.setChoices(a.map(r=>({value:r.id,label:r.text,selected:!1,disabled:!1})),"value","label",!1)}).catch(d=>{console.error("AJAX error:",d)})},300)}s.addEventListener("input",o),s.addEventListener("click",o)})},Alpine.store("page").multiSelect(),document.querySelectorAll(".image-upload");const g=document.querySelectorAll(".clear-img");g&&g.forEach(t=>{t.addEventListener("click",()=>{t.parentElement.parentElement.querySelector("input").value="",t.parentElement.parentElement.querySelector("img").src="/images/common/no_images.png"})}),Alpine.store("page").mask=t=>{let e=(t.value||"").replace(/\D+/g,"");if(e.startsWith("380")?e=e.slice(3):e.startsWith("0")&&(e=e.slice(1)),e=e.slice(0,9),!e.length){t.value="";return}let l="+380 ";e.length<=2?l+=e:e.length<=5?l+=e.slice(0,2)+" "+e.slice(2):e.length<=7?l+=e.slice(0,2)+" "+e.slice(2,5)+"-"+e.slice(5):l+=e.slice(0,2)+" "+e.slice(2,5)+"-"+e.slice(5,7)+"-"+e.slice(7,9),t.value=l}});
