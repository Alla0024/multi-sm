document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("form").forEach(function(e){e.addEventListener("submit",function(){e.querySelectorAll(".ignore_form").forEach(function(t){t.disabled=!0})})});const f=document.querySelectorAll("[data-tab]"),p=document.querySelectorAll("[data-for-tab]");function h(e){f.forEach(t=>{t.classList.toggle("active",t.dataset.tab===e)}),p.forEach(t=>{t.classList.toggle("active",t.dataset.forTab===e)})}if(f){f.forEach(t=>{t.addEventListener("click",()=>{h(t.dataset.tab)})});const e=document.querySelector("[data-tab].active");e&&h(e.dataset.tab)}Alpine.store("page").searchSelect=function(e){const t=e.parentElement,l=t.querySelector("[data-url]");t.querySelector('input[type="hidden"]');const a=t.querySelector(".custom-list"),o=l.dataset.url;let c;const d=r=>{a.innerHTML="",Array.isArray(r)&&r.length>0?r.forEach(s=>{const n=document.createElement("li");n.textContent=s.text,n.setAttribute("x-on:click",`setItem($event.target, key, ${s.id}, "${s.text.replace('"',"'").replace('"',"'")}")`),a.appendChild(n)}):a.innerHTML='<li style="color:#999;cursor:default;">Нічого не знайдено</li>'};(()=>{clearTimeout(c),c=setTimeout(()=>{const r=l.value.trim().toLowerCase();if(o)axios.get(o,{params:{q:r}}).then(s=>{d(s.data.items||[]),a.classList.remove("hide")}).catch(s=>{console.error("AJAX error:",s)});else{let s=!1;a.querySelectorAll("li").forEach(n=>{const u=n.textContent.toLowerCase().includes(r);n.style.display=u?"block":"none",u&&(s=!0)}),s?a.classList.remove("hide"):a.classList.add("hide")}},300)})(),document.addEventListener("click",r=>{t.contains(r.target)||a.classList.add("hide")})},document.querySelectorAll(".tag-select").forEach(e=>{const t=new Choices(e,{removeItemButton:!0,placeholderValue:"Виберіть або введіть...",searchPlaceholderValue:"Пошук...",duplicateItemsAllowed:!1,shouldSort:!1,searchEnabled:!e.dataset.noSearch});let l;const a=e.dataset.url;if(!a)return;const o=e.parentElement.querySelector('input[type="search"]');function c(d){const m=d.target.value;clearTimeout(l),l=setTimeout(()=>{axios.get(a,{params:{q:m}}).then(r=>{const s=r.data.items||[],n=Array.from(e.options).filter(i=>i.selected).map(i=>i.value),u=s.filter(i=>!n.includes(i.id.toString()));u.length&&t.setChoices(u.map(i=>({value:i.id,label:i.text,selected:!1,disabled:!1})),"value","label",!1)}).catch(r=>{console.error("AJAX error:",r)})},300)}o.addEventListener("input",c),o.addEventListener("click",c)}),document.querySelectorAll(".image-upload").forEach(e=>{const t=e.querySelector('input[type="file"]'),l=e.querySelector("img");t.addEventListener("change",a=>{const o=a.target.files[0];if(o&&o.type.startsWith("image/")){const c=new FileReader;c.onload=function(d){l.src=d.target.result,l.style.display="block"},c.readAsDataURL(o)}else l.src="",l.style.display="none",alert("Будь ласка, виберіть зображення (JPEG, PNG, WEBP...)")})})});
