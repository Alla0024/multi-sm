document.addEventListener("DOMContentLoaded",()=>{const v=document.querySelectorAll("[data-tab]"),b=document.querySelectorAll("[data-for-tab]");function L(t){v.forEach(e=>{e.classList.toggle("active",e.dataset.tab===t)}),b.forEach(e=>{e.classList.toggle("active",e.dataset.forTab===t)})}if(v){v.forEach(e=>{e.addEventListener("click",()=>{L(e.dataset.tab)})});const t=document.querySelector("[data-tab].active");t&&L(t.dataset.tab)}Alpine.store("page").searchSelect=function(t){const e=t.parentElement,l=e.querySelector("[data-url]"),i=e.querySelector('input[type="hidden"]'),a=e.querySelector(".custom-list"),r=l.dataset.url;let h;const y=(o,d="")=>{a.innerHTML="",Array.isArray(o)&&o.length>0?(o.forEach(s=>{if(s.text.toLowerCase().includes(d)){const u=document.createElement("li");if(u.textContent=s.id+" - "+s.text,l.getAttribute("custom")==="true"){let n=function(){l.value=s.text,i.value=s.id,a.classList.add("hide")};var c=n;u.removeEventListener("click",n),u.addEventListener("click",n)}else if(l.getAttribute("custom")==="method"){let n=function(){l.value=s.text,i.value=s.id,a.classList.add("hide")};var c=n;u.removeEventListener("click",n),u.addEventListener("click",n),u.setAttribute("x-on:click",`setItem($event.target, "${s.id}", "${s.text}")`)}else u.setAttribute("x-on:click",`setItem($event.target, keyData, ${s.id}, "${s.text.replace('"',"'").replace('"',"'")}")`);a.appendChild(u)}}),a.innerHTML==""&&(a.innerHTML='<li style="color:#999;cursor:default;">Нічого не знайдено</li>')):a.innerHTML='<li style="color:#999;cursor:default;">Нічого не знайдено</li>'};(()=>{clearTimeout(h),h=setTimeout(()=>{const o=l.value.trim().toLowerCase();if(r)axios.get(r,{params:{q:o}}).then(d=>{y(d.data.items||[],o),a.classList.remove("hide")}).catch(d=>{console.error("AJAX error:",d)});else{let d=!1;a.querySelectorAll("li").forEach(s=>{const c=s.textContent.toLowerCase().includes(o);if(l.getAttribute("custom")==="true"){let n=function(){l.value=s.textContent,i.value=s.id,a.classList.add("hide")};var u=n;s.removeEventListener("click",n),s.addEventListener("click",n)}else l.getAttribute("custom")==="method"?s.setAttribute("x-on:click","setItem($event.target)"):s.setAttribute("x-on:click",`setItem($event.target, keyData, ${item.id}, "${item.text.replace('"',"'").replace('"',"'")}")`);s.style.display=c?"block":"none",c&&(d=!0)}),d?a.classList.remove("hide"):a.classList.add("hide")}o==""&&(i.value="")},300)})(),document.addEventListener("click",o=>{e.contains(o.target)||a.classList.add("hide")})};let f=[];Alpine.store("page").multiSelect=function(){f=[],document.querySelectorAll(".tag-select").forEach(t=>{const e=new Choices(t,{removeItemButton:!0,placeholderValue:"Виберіть або введіть...",searchPlaceholderValue:"Пошук...",duplicateItemsAllowed:!1,shouldSort:!1,searchEnabled:!t.dataset.noSearch});let l;const i=t.dataset.url;if(!i){f.push(e);return}const a=t.parentElement.querySelector('input[type="search"]');function r(h){const y=h.target.value;clearTimeout(l),l=setTimeout(()=>{axios.get(i,{params:{q:y}}).then(p=>{const o=p.data.items||[];if(o[0]&&o[0].children){const d=Array.from(t.options).filter(c=>c.selected).map(c=>c.value),s=o.map(c=>{const u=(c.children||[]).filter(n=>!d.includes(n.id.toString()));return{label:c.text,id:c.text.toLowerCase().replace(/\s+/g,"_"),choices:u.map(n=>({value:n.id,label:n.text,selected:!1,disabled:!1}))}}).filter(c=>c.choices.length>0);s.length&&e.setChoices(s,"value","label",!1)}else{const d=Array.from(t.options).filter(c=>c.selected).map(c=>c.value),s=o.filter(c=>!d.includes(c.id.toString()));s.length&&e.setChoices(s.map(c=>({value:c.id,label:c.text,selected:!1,disabled:!1})),"value","label",!1)}}).catch(p=>{console.error("AJAX error:",p)})},300)}a.addEventListener("input",r),a.addEventListener("click",r),f.push(e)})},Alpine.store("page").multiSelectDestroy=function(){console.log(f),f.forEach(t=>t.destroy())},Alpine.store("page").multiSelect();let E=document.querySelectorAll(".image-uploaddd");E&&E.forEach(t=>{const e=t.querySelector('input[type="file"]'),l=t.querySelector("img");e.addEventListener("change",i=>{const a=i.target.files[0];if(a&&a.type.startsWith("image/")){const r=new FileReader;r.onload=function(h){l.src=h.target.result,l.style.display="block"},r.readAsDataURL(a)}else l.src="",l.style.display="none",alert("Будь ласка, виберіть зображення (JPEG, PNG, WEBP...)")})});const A=document.querySelectorAll(".clear-img");A&&A.forEach(t=>{t.addEventListener("click",()=>{t.parentElement.parentElement.querySelector("input").value="",t.parentElement.parentElement.querySelector("img").src="/images/common/no_images.png"})}),Alpine.store("page").mask=t=>{let e=(t.value||"").replace(/\D+/g,"");if(e.startsWith("380")?e=e.slice(3):e.startsWith("0")&&(e=e.slice(1)),e=e.slice(0,9),!e.length){t.value="";return}let l="+380 ";e.length<=2?l+=e:e.length<=5?l+=e.slice(0,2)+" "+e.slice(2):e.length<=7?l+=e.slice(0,2)+" "+e.slice(2,5)+"-"+e.slice(5):l+=e.slice(0,2)+" "+e.slice(2,5)+"-"+e.slice(5,7)+"-"+e.slice(7,9),t.value=l};const g=document.querySelector(".checkbox-father");g&&g.addEventListener("change",()=>{document.querySelectorAll(".checkbox-child").forEach(t=>{t.checked=g.checked})});const m=document.getElementById("search_form");m&&m.addEventListener("submit",function(t){const e=document.querySelector("#multiple_search");if(e){const l=e.name.replace("[]",""),i=Array.from(e.selectedOptions).map(h=>h.value),a=m.querySelector(`input[name="${l}"]`);a&&a.remove();const r=document.createElement("input");r.type="hidden",r.name=l,r.value=i.join(","),m.appendChild(r),e.disabled=!0}});const S=document.querySelectorAll(".change-sort-order");S.length>0&&S.forEach(t=>{let e=t.parentElement.querySelector('input[name="product_id"]'),l=t.parentElement.querySelector('input[name="new_value"]'),i=e.dataset.action;t.addEventListener("click",()=>{t.classList.add("hide"),l.classList.remove("hide"),l.focus(),l.addEventListener("keypress",function(a){a.key==="Enter"&&axios.post(i,{product_id:e.value,sort_order:l.value}).then(r=>{console.log(r),l.classList.add("hide"),t.classList.remove("hide"),t.innerHTML=l.value}).catch(r=>console.log(r))})})}),Alpine.store("page").showOversize=function(t,e=!0){const l=document.querySelector(t);l&&(l.querySelectorAll("input, select, textarea, button").forEach(i=>{i.disabled=e}),e?l.classList.remove("active"):l.classList.add("active"))}});
