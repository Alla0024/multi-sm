document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("form").forEach(function(e){e.addEventListener("submit",function(){e.querySelectorAll(".ignore_form").forEach(function(t){t.disabled=!0})})});const h=document.querySelectorAll("[data-tab]"),p=document.querySelectorAll("[data-for-tab]");function m(e){h.forEach(t=>{t.classList.toggle("active",t.dataset.tab===e)}),p.forEach(t=>{t.classList.toggle("active",t.dataset.forTab===e)})}if(h){h.forEach(t=>{t.addEventListener("click",()=>{m(t.dataset.tab)})});const e=document.querySelector("[data-tab].active");e&&m(e.dataset.tab)}Alpine.store("page").searchSelect=function(e){const t=e.parentElement,l=t.querySelector("[data-url]"),i=t.querySelector('input[type="hidden"]'),a=t.querySelector(".custom-list"),n=l.dataset.url;let d;const f=o=>{a.innerHTML="",Array.isArray(o)&&o.length>0?o.forEach(r=>{const c=document.createElement("li");c.textContent=r.text;function s(){l.value=r.text,i.value=r.id,a.classList.add("hide")}c.removeEventListener("click",s),c.addEventListener("click",s),a.appendChild(c)}):a.innerHTML='<li style="color:#999;cursor:default;">Нічого не знайдено</li>'};(()=>{clearTimeout(d),d=setTimeout(()=>{const o=l.value.trim().toLowerCase();if(n)axios.get(n,{params:{q:o}}).then(r=>{f(r.data.items||[]),a.classList.remove("hide")}).catch(r=>{console.error("AJAX error:",r)});else{let r=!1;a.querySelectorAll("li").forEach(c=>{const s=c.textContent.toLowerCase().includes(o);c.style.display=s?"block":"none",s&&(r=!0)}),r?a.classList.remove("hide"):a.classList.add("hide")}},300)})(),document.addEventListener("click",o=>{t.contains(o.target)||a.classList.add("hide")})},document.querySelectorAll(".tag-select").forEach(e=>{const t=new Choices(e,{removeItemButton:!0,placeholderValue:"Виберіть або введіть...",searchPlaceholderValue:"Пошук...",duplicateItemsAllowed:!1,shouldSort:!1,searchEnabled:!e.dataset.noSearch});let l;const i=e.dataset.url;if(!i)return;const a=e.parentElement.querySelector('input[type="search"]');function n(d){const f=d.target.value;clearTimeout(l),l=setTimeout(()=>{axios.get(i,{params:{q:f}}).then(u=>{const o=u.data.items||[],r=Array.from(e.options).filter(s=>s.selected).map(s=>s.value),c=o.filter(s=>!r.includes(s.id.toString()));c.length&&t.setChoices(c.map(s=>({value:s.id,label:s.text,selected:!1,disabled:!1})),"value","label",!1)}).catch(u=>{console.error("AJAX error:",u)})},300)}a.addEventListener("input",n),a.addEventListener("click",n)}),document.querySelectorAll(".image-upload").forEach(e=>{const t=e.querySelector('input[type="file"]'),l=e.querySelector("img");t.addEventListener("change",i=>{const a=i.target.files[0];if(a&&a.type.startsWith("image/")){const n=new FileReader;n.onload=function(d){l.src=d.target.result,l.style.display="block"},n.readAsDataURL(a)}else l.src="",l.style.display="none",alert("Будь ласка, виберіть зображення (JPEG, PNG, WEBP...)")})})});
